<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="FlightFinder - Search and compare flight prices from multiple airlines. Find the best deals on flights worldwide.">
  <title>FlightFinder – Find Your Perfect Flight</title>
  <link rel="stylesheet" href="flightfinder-theme.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✈️</text></svg>">

   <!-- Website ownership verification script -->
   <script data-noptimize="1" data-cfasync="false" data-wpfc-render="false">
     (function () {
         var script = document.createElement("script");
         script.async = 1;
         script.src = 'https://tp-em.com/NDg0Njc4.js?t=484678';
         document.head.appendChild(script);
     })();
   </script>
</head>
<body>

  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Header with Navigation -->
  <header class="header" role="banner">
    <nav class="nav-container" role="navigation" aria-label="Main navigation">
      <div class="logo">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M21 16V14L13 9V3.5C13 2.67 12.33 2 11.5 2C10.67 2 10 2.67 10 3.5V9L2 14V16L10 13.5V19L8 20.5V22L11.5 21L15 22V20.5L13 19V13.5L21 16Z" fill="currentColor"/>
        </svg>
        <span class="logo-text">FlightFinder</span>
      </div>
      <ul class="nav-menu">
        <li><a href="#search-section" class="nav-link active">Search</a></li>
        <li><a href="#how-it-works" class="nav-link">How It Works</a></li>
        <li><a href="#about" class="nav-link">About</a></li>
      </ul>
    </nav>
  </header>

  <!-- Main Content -->
  <main id="main-content" role="main">
    
    <!-- Hero Section -->
    <section class="hero" aria-labelledby="hero-heading">
      <div class="hero-content">
        <h1 id="hero-heading" class="hero-title">Find Your Perfect Flight</h1>
        <p class="hero-subtitle">Search millions of flights and discover the best deals worldwide</p>
      </div>
      <div class="hero-background" aria-hidden="true"></div>
    </section>

    <!-- Search Section -->
    <section id="search-section" class="search-section" aria-labelledby="search-heading">
      <div class="container">
        <h2 id="search-heading" class="section-title visually-hidden">Flight Search</h2>
        
        <div class="search-card">
          <!-- User Greeting (shown after login) -->
          <div id="user-greeting" style="display:none;"></div>
          
          <!-- Login Form (shown before login) -->
          <div id="login-form-container">
            <form id="login-form">
              <label for="username">Enter your name:</label>
              <input type="text" id="username" name="username" required>
              <button type="submit">Login</button>
            </form>
          </div>

          <!-- Flight Search Form -->
          <form id="flight-form" class="search-form" role="search" aria-label="Flight search form">
            
            <!-- Search Inputs Grid -->
            <div class="search-grid">
              
              <!-- Origin Input with Autocomplete -->
              <div class="form-group">
                <label for="origin" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                  </svg>
                  From
                </label>
                <div class="autocomplete-wrapper">
                  <input 
                    type="text" 
                    id="origin" 
                    name="origin" 
                    class="form-input" 
                    placeholder="City or Airport"
                    autocomplete="off"
                    required
                    aria-autocomplete="list"
                  >
                  <div id="origin-suggestions" class="suggestions"></div>
                </div>
              </div>

              <!-- Destination Input with Autocomplete -->
              <div class="form-group">
                <label for="destination" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  </svg>
                  To
                </label>
                <div class="autocomplete-wrapper">
                  <input 
                    type="text" 
                    id="destination" 
                    name="destination" 
                    class="form-input" 
                    placeholder="City or Airport"
                    autocomplete="off"
                    required
                    aria-autocomplete="list"
                  >
                  <div id="destination-suggestions" class="suggestions"></div>
                </div>
              </div>

              <!-- Departure Date -->
              <div class="form-group">
                <label for="depart-date" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M3 10H21M8 2V6M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Departure
                </label>
                <input 
                  type="date" 
                  id="depart-date" 
                  name="depart-date" 
                  class="form-input" 
                  required
                >
              </div>

              <!-- Return Date -->
              <div class="form-group">
                <label for="return-date" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M3 10H21M8 2V6M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Return
                </label>
                <input 
                  type="date" 
                  id="return-date" 
                  name="return-date" 
                  class="form-input"
                >
              </div>
            </div>

            <!-- Search Button -->
            <button type="submit" class="search-button" aria-label="Search for flights">
              <svg class="button-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Search Flights</span>
            </button>
          </form>

          <!-- Flight Results Lists -->
          <ul id="flights-list"></ul>
          <ul id="return-flights-list"></ul>
        </div>
      </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="info-section" aria-labelledby="how-it-works-heading">
      <div class="container">
        <h2 id="how-it-works-heading" class="section-title">How It Works</h2>
        <div class="features-grid">
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <h3 class="feature-title">Search</h3>
            <p class="feature-description">Enter your departure and destination cities with your travel dates. Our autocomplete feature helps you find airports quickly.</p>
          </article>
          
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M9 5L16 12L9 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h3 class="feature-title">Compare</h3>
            <p class="feature-description">We search through multiple airlines and travel providers to find you the best available prices and flight options.</p>
          </article>
          
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M21 16V14L13 9V3.5C13 2.67 12.33 2 11.5 2C10.67 2 10 2.67 10 3.5V9L2 14V16L10 13.5V19L8 20.5V22L11.5 21L15 22V20.5L13 19V13.5L21 16Z" fill="currentColor"/>
              </svg>
            </div>
            <h3 class="feature-title">Book</h3>
            <p class="feature-description">View detailed flight information including prices, airlines, and flight times. Choose the best option for your journey.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="info-section about-section" aria-labelledby="about-heading">
      <div class="container">
        <h2 id="about-heading" class="section-title">About FlightFinder</h2>
        <div class="about-content">
          <p>FlightFinder helps travelers find the best flight deals by searching across multiple airlines and travel providers. Our platform is designed to make flight search simple, fast, and efficient.</p>
          <p>We use real-time data from Travelpayouts API to provide you with up-to-date flight information and competitive pricing. Whether you're planning a business trip or a vacation, FlightFinder helps you make informed travel decisions.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3 class="footer-title">FlightFinder</h3>
          <p class="footer-text">Your trusted flight search companion</p>
        </div>
        <div class="footer-section">
          <h4 class="footer-subtitle">Links</h4>
          <ul class="footer-links">
            <li><a href="#search-section">Search Flights</a></li>
            <li><a href="#how-it-works">How It Works</a></li>
            <li><a href="#about">About</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4 class="footer-subtitle">Connect</h4>
          <p class="footer-text">© 2025 FlightFinder. All rights reserved.</p>
          <p class="footer-text">Powered by Travelpayouts API</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    const API_KEY = 'd2e27a08557382081d80ed4268fbb552';
    
    // ========== Login Logic ==========
    function showGreeting(name) {
      const greeting = document.getElementById('user-greeting');
      greeting.textContent = `Welcome back, ${name}!`;
      greeting.style.display = 'block';
    }
    
    function showLogin(show) {
      document.getElementById('login-form-container').style.display = show ? 'block' : 'none';
    }
    
    function checkLogin() {
      const name = localStorage.getItem('flight_username');
      if (name) {
        showGreeting(name);
        showLogin(false);
      } else {
        showLogin(true);
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      checkLogin();
      
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const name = document.getElementById('username').value.trim();
          if (name) {
            localStorage.setItem('flight_username', name);
            showGreeting(name);
            showLogin(false);
          }
        });
      }
      
      // Smooth scroll for navigation links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Update active state
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            this.classList.add('active');
          }
        });
      });
    });
    
    // ========== Autocomplete Logic ==========
    function setupAutocomplete(inputId, suggestionsId) {
      const input = document.getElementById(inputId);
      const suggestionsDiv = document.getElementById(suggestionsId);
      let currentList = null;
      
      input.addEventListener('input', function() {
        const term = input.value.trim();
        if (term.length < 2) {
          if (currentList) currentList.remove();
          return;
        }
        
        fetch(`https://autocomplete.travelpayouts.com/places2?term=${encodeURIComponent(term)}&locale=en&types[]=country&types[]=city&types[]=airport`)
          .then(r => r.json())
          .then(data => {
            if (currentList) currentList.remove();
            const ul = document.createElement('ul');
            ul.className = 'suggestions-list';
            
            data.forEach(item => {
              let label = item.name;
              if (item.type === 'airport') {
                label += ` (${item.code}) - ${item.city_name}, ${item.country_name}`;
              } else if (item.type === 'city') {
                label += ` (${item.code}) - ${item.country_name}`;
              } else if (item.type === 'country') {
                label += ` (${item.code})`;
              }
              
              const li = document.createElement('li');
              li.textContent = label;
              li.dataset.code = item.code;
              li.dataset.name = item.name;
              li.dataset.type = item.type;
              
              li.addEventListener('mousedown', function(e) {
                input.value = label;
                input.dataset.code = item.code;
                input.dataset.type = item.type;
                ul.remove();
              });
              
              ul.appendChild(li);
            });
            
            if (data.length > 0) suggestionsDiv.appendChild(ul);
            currentList = ul;
          });
      });
      
      input.addEventListener('blur', function() {
        setTimeout(() => { if (currentList) currentList.remove(); }, 200);
      });
    }
    
    setupAutocomplete('origin', 'origin-suggestions');
    setupAutocomplete('destination', 'destination-suggestions');
    
    // ========== Flight Search Logic ==========
    document.getElementById('flight-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const originInput = document.getElementById('origin');
      const destInput = document.getElementById('destination');
      const departDate = document.getElementById('depart-date').value;
      const returnDate = document.getElementById('return-date').value;
      
      const originCode = originInput.dataset.code;
      const destCode = destInput.dataset.code;
      
      if (!originCode || !destCode) {
        alert('Please select valid airports or cities from the suggestions.');
        return;
      }
      
      const flightsList = document.getElementById('flights-list');
      const returnFlightsList = document.getElementById('return-flights-list');
      flightsList.innerHTML = '';
      returnFlightsList.innerHTML = '';
      
      // Helper to format date
      function formatDate(dt) {
        return dt ? new Date(dt).toLocaleDateString('en-GB') : 'N/A';
      }
      
      // Helper to add flight info
      function addFlightInfo(type, flight, listElem) {
        const li = document.createElement('li');
        li.className = 'flight-result-card';
        li.innerHTML = `
          <div class="flight-header"><strong>${type}</strong></div>
          <div class="flight-details">
            <div class="flight-route"><strong>From:</strong> ${flight.origin} <strong>To:</strong> ${flight.destination}</div>
            <div class="flight-date"><strong>Departure:</strong> ${formatDate(flight.departure_at)}</div>
            <div class="flight-price"><strong>Price:</strong> ${flight.value} ${flight.currency}</div>
            <div class="flight-airline"><strong>Airline:</strong> ${flight.airline || 'N/A'}</div>
            <div class="flight-number"><strong>Flight #:</strong> ${flight.flight_number || 'N/A'}</div>
            ${flight.link ? `<div class="flight-booking"><a href='${flight.link}' target='_blank' class="book-button">Book Now</a></div>` : ''}
          </div>
        `;
        listElem.appendChild(li);
      }
      
      // Fetch and display flights
      function fetchFlights(from, to, date, typeLabel, listElem) {
        const url = `https://flightfinder-website.onrender.com/api/travelpayouts/flights?origin=${from}&destination=${to}&departure_at=${date}`;
        
        fetch(url)
          .then(async r => {
            if (!r.ok) {
              const text = await r.text();
              throw new Error(`HTTP ${r.status}: ${text}`);
            }
            return r.json();
          })
          .then(data => {
            if (data.error) {
              listElem.innerHTML = `<li class="error-message">API Error: ${data.error}</li>`;
              console.error('API Error:', data);
              return;
            }
            
            if (data.data && Array.isArray(data.data) && data.data.length > 0) {
              // Sort by proximity to selected date
              const sorted = data.data.slice().sort((a, b) => {
                const dA = Math.abs(new Date(a.departure_at) - new Date(date));
                const dB = Math.abs(new Date(b.departure_at) - new Date(date));
                return dA - dB;
              });
              sorted.slice(0, 5).forEach(flight => addFlightInfo(typeLabel, flight, listElem));
            } else {
              listElem.innerHTML = `<li class="no-results">No ${typeLabel.toLowerCase()} flights found.</li>`;
              console.warn('No flights found:', data);
            }
          })
          .catch(err => {
            listElem.innerHTML = `<li class="error-message">Error fetching ${typeLabel.toLowerCase()} flights.<br><span style='color:#dc3545;'>${err.message}</span></li>`;
            console.error('Fetch error:', err);
          });
      }
      
      // Fetch outbound flights
      fetchFlights(originCode, destCode, departDate, 'Departure', flightsList);
      
      // Fetch return flights if date provided
      returnFlightsList.innerHTML = '<li class="section-header"><strong>Return Flights</strong></li>';
      if (returnDate) {
        fetchFlights(destCode, originCode, returnDate, 'Return', returnFlightsList);
      } else {
        returnFlightsList.innerHTML += '<li class="info-message">No return date selected.</li>';
      }
      
      // Scroll to results
      setTimeout(() => {
        flightsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 500);
    });
  </script>
</body>
</html>
